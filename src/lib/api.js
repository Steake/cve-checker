/**
 * Fetches repositories from GitHub API
 * @returns {Promise<Array>}
 */
export async function fetchGithubPocs() {
	const res = await fetch(
		'https://api.github.com/search/repositories?q=CVE+POC+created:>2024-01-01&sort=updated&order=desc'
	);
	const data = await res.json();

	return data.items.map(item => ({
		title: item.name,
		description: item.description,
		url: item.html_url,
		author: item.owner.login,
		stars: item.stargazers_count,
		created: item.created_at,
		updated: item.updated_at,
		source: 'github'
	}));
}

/**
 * Fetches repositories from GitLab API
 * @returns {Promise<Array>}
 */
export async function fetchGitlabPocs() {
	const res = await fetch(
		'https://gitlab.com/api/v4/projects?search=CVE+POC&order_by=updated_at&sort=desc'
	);
	const data = await res.json();

	return data.map(item => ({
		title: item.name,
		description: item.description,
		url: item.web_url,
		author: item.namespace.name,
		stars: item.star_count,
		created: item.created_at,
		updated: item.last_activity_at,
		source: 'gitlab'
	}));
}

/**
 * Fetches repositories from both GitHub and GitLab
 * @returns {Promise<Array>}
 */
export async function fetchAllPocs() {
	try {
		const [github, gitlab] = await Promise.allSettled([
			fetchGithubPocs(),
			fetchGitlabPocs()
		]);

		return [
			...(github.status === 'fulfilled' ? github.value : []),
			...(gitlab.status === 'fulfilled' ? gitlab.value : [])
		];
	} catch (error) {
		console.error('Error fetching PoCs:', error);
		return [];
	}
}